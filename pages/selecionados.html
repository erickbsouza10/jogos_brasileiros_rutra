<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jogos Selecionados</title>

    <link rel="stylesheet" href="../css/main.css" />
</head>

<body class="bg-background min-h-screen">

    <!-- HEADER -->
    <header class="bg-surface border-b border-border sticky top-0 z-nav">
        <div class="max-w-7xl mx-auto px-sm md:px-lg py-sm flex items-center justify-between">
            <div>
                <h1 class="text-xl font-heading font-bold text-primary">
                    Jogos Selecionados
                </h1>
                <p class="text-xs text-text-secondary">
                    Revise sua agenda personalizada
                </p>
            </div>

            <div class="flex gap-2">
                <button id="voltarBtn" class="btn-secondary">
                    Voltar
                </button>
                <button id="limparBtn" class="btn-danger">
                    Limpar tudo
                </button>
            </div>
        </div>
    </header>

    <!-- CONTEÚDO -->
    <main class="max-w-7xl mx-auto px-sm md:px-lg py-lg">
        <div id="listaSelecionados" class="space-y-8"></div>

        <!-- EMPTY STATE -->
        <div id="emptyState" class="hidden text-center py-24 text-text-secondary">
            <h3 class="text-2xl font-heading font-bold mb-3">
                Nenhum jogo selecionado
            </h3>
            <p class="mb-6">
                Volte para a agenda e selecione pelo menos um jogo.
            </p>
            <button id="voltarEmptyBtn" class="btn-primary">
                Voltar para agenda
            </button>
        </div>
    </main>

    <script type="module">
        import { getTimeById } from "../js/times-utils.js";

        const STORAGE_KEY = "agenda_jogos_selecionados";
        const container = document.getElementById("listaSelecionados");
        const emptyState = document.getElementById("emptyState");

        const dados = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

        /* ===============================
           UTILIDADES
        ================================ */

        function parseDate(dateStr) {
            return new Date(dateStr + "T00:00:00");
        }

        function formatDateBR(date) {
            return date.toLocaleDateString("pt-BR", {
                day: "2-digit",
                month: "long",
                year: "numeric"
            });
        }

        function formatWeekDay(date) {
            return date.toLocaleDateString("pt-BR", {
                weekday: "long"
            });
        }

        /* ===============================
           RENDER
        ================================ */

        const datas = Object.keys(dados).sort();

        if (datas.length === 0) {
            emptyState.classList.remove("hidden");
        } else {
            datas.forEach(data => {
                const dateObj = parseDate(data);

                const section = document.createElement("section");
                section.className = "space-y-4";

                section.innerHTML = `
        <header class="flex items-center justify-between" style="margin-top: 20px">
          <h2 class="text-2xl font-heading font-bold text-primary capitalize">
            ${formatDateBR(dateObj)}
          </h2>
          <span class="text-sm text-primary capitalize" style="font-size: 20px">
            ${formatWeekDay(dateObj)}
          </span>
        </header>
      `;

                const lista = document.createElement("div");
                lista.className = "space-y-3";

                dados[data].forEach(jogo => {
                    if (!jogo.mandante || !jogo.visitante) return;

                    const mandante = getTimeById(jogo.mandante.id, jogo.mandante.nome);
                    const visitante = getTimeById(jogo.visitante.id, jogo.visitante.nome);

                    const card = document.createElement("article");
                    card.className = "card flex items-center justify-between";

                    card.innerHTML = `
          <div>
            <span class="text-xs font-semibold text-accent">
              ${jogo.campeonato}
            </span>

            <div class="flex items-center gap-2 mt-1">
              <img 
                src="${mandante.escudo}" 
                class="w-6 h-6"
                alt="${mandante.nome}"
                onerror="this.onerror=null;this.src='https://cdn-icons-png.freepik.com/512/786/786346.png';"
              />
              <strong>${mandante.nome}</strong>

              <span class="mx-1">x</span>

              <strong>${visitante.nome}</strong>
              <img 
                src="${visitante.escudo}" 
                class="w-6 h-6"
                alt="${visitante.nome}"
                onerror="this.onerror=null;this.src='https://cdn-icons-png.freepik.com/512/786/786346.png';"
              />
            </div>
          </div>

          <div class="text-sm text-text-secondary">
            ${jogo.horario ?? "--:--"}
          </div>
        `;

                    lista.appendChild(card);
                });

                section.appendChild(lista);
                container.appendChild(section);
            });
        }

        /* ===============================
           AÇÕES
        ================================ */

        document.getElementById("voltarBtn").addEventListener("click", () => {
            window.history.back();
        });

        document.getElementById("voltarEmptyBtn")?.addEventListener("click", () => {
            window.location.href = "./daily_match_details.html";
        });

        document.getElementById("limparBtn").addEventListener("click", () => {
            if (confirm("Deseja remover todos os jogos selecionados?")) {
                localStorage.removeItem(STORAGE_KEY);
                window.location.reload();
            }
        });
    </script>
    <script>
        /* ===============================
           MAPA DE ESCUDOS POR NOME (ALT)
        ================================ */
        const ESCUDOS_POR_ALT = {
            "Atlético-MG": "https://upload.wikimedia.org/wikipedia/commons/2/27/Clube_Atl%C3%A9tico_Mineiro_logo.svg",
            "Palmeiras": "https://upload.wikimedia.org/wikipedia/commons/1/10/Palmeiras_logo.svg",
            "Flamengo": "https://upload.wikimedia.org/wikipedia/commons/9/96/Clube_de_Regatas_do_Flamengo_logo.svg",
            "Corinthians": "https://logodownload.org/wp-content/uploads/2016/11/corinthians-logo-01.png",
            "São Paulo": "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Brasao_do_Sao_Paulo_Futebol_Clube.svg/960px-Brasao_do_Sao_Paulo_Futebol_Clube.svg.png",
            "Vasco": "https://upload.wikimedia.org/wikipedia/pt/a/ac/CRVascodaGama.png",
            "Botafogo": "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Escudo_Botafogo.png/500px-Escudo_Botafogo.png",
            "Grêmio": "https://upload.wikimedia.org/wikipedia/commons/0/08/Gremio_logo.svg",
            "Internacional": "https://upload.wikimedia.org/wikipedia/commons/f/f1/Escudo_do_Sport_Club_Internacional.svg",
            "Cruzeiro": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZgLejZzik3T0lzJ2vHx5eaUBU1DzIsYyVGw&s",
            "Bahia": "https://cdn.worldvectorlogo.com/logos/bahia-1.svg",
            "Vitória": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1VOPpDMQEOqBzB6u8InTfBMK073ozgU0hWQ&s",
            "Athletico Paranaense": "https://logodownload.org/wp-content/uploads/2018/12/athletico-pr-logo-0.png",
            "Coritiba": "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Coritiba_Foot_Ball_Club_logo.svg/250px-Coritiba_Foot_Ball_Club_logo.svg.png",
            "Santos": "https://upload.wikimedia.org/wikipedia/commons/3/35/Santos_logo.svg",
            "Chapecoense": "https://upload.wikimedia.org/wikipedia/pt/b/bc/Escudo_de_2018_da_Chapecoense.png",
            "Mirassol": "https://upload.wikimedia.org/wikipedia/commons/c/cf/Mirassol_FC_Escudo.jpg",
            "Remo": "https://www.clubedoremo.com.br/images/escudo-simbolo.png",

            /* PARAIBANO */
            "Botafogo-PB": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRRANgUhrw7cT0NzbtL25dkTfNWSAreRi1MgQ&s",
            "Treze": "https://trezefc.com.br/wp-content/uploads/2024/01/escudo.png",
            "Campinense": "https://upload.wikimedia.org/wikipedia/commons/f/fb/Campinense.png",
            "Sousa": "https://upload.wikimedia.org/wikipedia/pt/thumb/b/ba/SousaEC.png/120px-SousaEC.png",
            "Nacional de Patos": "https://upload.wikimedia.org/wikipedia/pt/3/32/NacionalPatos.png",
            "CSP": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSL-Q08krOd8J932UJ9i6l4Us_M5TMbfFhJjg&s",
            "Serra Branca": "https://upload.wikimedia.org/wikipedia/pt/2/29/SerraBrancaEC.png",
            "Atlético de Cajazeiras": "https://upload.wikimedia.org/wikipedia/pt/3/38/AtleticoCajazeirenseD.png",
            "Pombal EC": "https://upload.wikimedia.org/wikipedia/pt/0/0a/Escudo_Pombal.png",
            "Esporte de Patos": "https://upload.wikimedia.org/wikipedia/pt/c/c8/Esporte_Clube_de_Patos_logo.png",
            "Atlético-PB": "https://upload.wikimedia.org/wikipedia/pt/3/38/AtleticoCajazeirenseD.png",
            "Confiança-PB": "https://upload.wikimedia.org/wikipedia/commons/d/dd/AD_Confian%C3%A7a_shield.png"
        };

        /* ===============================
           NORMALIZA TEXTO
        ================================ */
        function normalizarTexto(txt) {
            return txt
                ?.toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .trim();
        }

        /* ===============================
           APLICA ESCUDOS PELO ALT
        ================================ */
        function aplicarEscudosPorAlt() {
            document.querySelectorAll("img[alt]").forEach(img => {
                const alt = img.getAttribute("alt");
                if (!alt) return;

                const altNormalizado = normalizarTexto(alt);

                for (const nome in ESCUDOS_POR_ALT) {
                    if (normalizarTexto(nome) === altNormalizado) {
                        if (img.src !== ESCUDOS_POR_ALT[nome]) {
                            img.src = ESCUDOS_POR_ALT[nome];
                        }
                        return;
                    }
                }
            });
        }

        /* ===============================
           OBSERVA CONTEÚDO DINÂMICO
        ================================ */
        const observer = new MutationObserver(() => {
            aplicarEscudosPorAlt();
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        /* PRIMEIRA EXECUÇÃO */
        document.addEventListener("DOMContentLoaded", aplicarEscudosPorAlt);
    </script>


</body>

</html>